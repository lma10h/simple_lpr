# Система Распознавания Номеров (ANPR) - Этап 2: OCR Модель

Разработка, обучение и оптимизация (квантизация) кастомной модели для распознавания текста (OCR) на изображениях автомобильных номеров.

## Цель этапа

Основной задачей этапа было создание высокоточной и быстрой OCR-модели, способной эффективно распознавать символы на предварительно вырезанных изображениях номерных знаков, в том числе на "сложных" примерах (размытие, низкое разрешение).

По итогам работы была получена **State-of-the-Art** модель, которая после INT8-квантизации демонстрирует **98.4%** точности полного распознавания на тестовой выборке при ускорении работы на CPU почти **в 2 раза**.

## Структура проекта

-   `ocr_train.ipynb`: Основной Jupyter Notebook, содержащий весь пайплайн:
    -   Анализ и подготовка данных.
    -   Реализация архитектуры CRNN на PyTorch.
    -   Цикл обучения и валидации.
    -   Анализ результатов (построение графиков и матриц ошибок).
    -   Оптимизация (квантизация) и финальный бенчмарк.
-   `crnn_ocr_model_best.pth`: **Ключевой артефакт.** Веса лучшей высокоточной модели в формате FP32.
-   `crnn_ocr_model_int8_fx.pth`: **Финальный артефакт для продакшена.** Веса оптимизированной (квантованной) INT8-модели, готовой к использованию.

## Архитектура и Обучение

-   **Архитектура:** CRNN (Convolutional Recurrent Neural Network).
    -   **CNN-часть:** Последовательность сверточных слоев для извлечения визуальных признаков.
    -   **RNN-часть:** Двунаправленный (bidirectional) LSTM для анализа последовательности признаков.
-   **Функция потерь:** CTCLoss, идеально подходящая для задач распознавания последовательностей без посимвольной разметки.
-   **Фреймворк:** PyTorch.

Процесс обучения проводился на [Nomeroff Russian license plates](https://www.kaggle.com/datasets/evgrafovmaxim/nomeroff-russian-license-plates)  (~1.4 ГБ) с примерами реальных номерных знаков.

## Результаты

### Финальные метрики (оценка на **невидимой** тестовой выборке)

| Модель | Точность (Exact Match) | Ошибка по символам (CER) | Ускорение (CPU) |
| :--- | :--- | :--- | :--- |
| **FP32 (Исходная)** | **98.42%** | **0.22%** | 1x |
| **INT8 (Квантованная)**| **98.38%** | **0.22%** | **~2x** |

### Ключевые выводы

1.  **Высочайшая точность:** Достигнута точность **98.4%** полного совпадения на тестовых данных, что является результатом промышленного уровня.
2.  **Эффективная оптимизация:** Квантизация позволила **ускорить модель почти в 2 раза** на CPU при **пренебрежимо малой потере точности (0.04%)**. Ошибка на уровне символов (CER) не изменилась вовсе.
3.  **Отсутствие переобучения:** Графики обучения показывают идеальное схождение кривых `Train Loss` и `Validation Loss`, что свидетельствует о высокой обобщающей способности модели.

**Графики обучения:**
![alt text](curves.png)

**Матрица ошибок:**
![alt text](matrix.png)

## Воспроизведение

Для воспроизведения результатов необходимо выполнить все ячейки в `ocr_train.ipynb`. Ноутбук самодостаточен и включает в себя все шаги от подготовки данных до финального сравнения моделей.

## Следующие шаги

Следующим этапом является **сборка финального end-to-end пайплайна**, который будет объединять модель детектора (из Этапа 1) и полученную здесь оптимизированную OCR-модель для распознавания номеров на полноразмерных изображениях и видео.